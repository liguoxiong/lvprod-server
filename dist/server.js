!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=19)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("joi")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("@babel/runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("dotenv/config")},function(e,t){e.exports=require("prerender-node")},function(e,t,r){"use strict";r.r(t);var s=r(7),n=r.n(s),a=(r(17),r(4)),u=r.n(a),c=r(12),i=r.n(c),o=r(8),d=r.n(o),p=r(5),l=r.n(p);l.a.config();var m=function(e,t,r){var s=e.headers["x-access-token"]||e.headers.authorization;if(!s)return t.status(401).send("Access denied. No token provided.");try{var n=d.a.verify(s,process.env.SECRET_KEY);e.user=n,r()}catch(e){t.status(400).send("Invalid token.")}},g=r(6),f=r.n(g),b=r(0),y=r.n(b),v=r(1),x=r.n(v),h=r(10),k=r.n(h),w=r(13),I=r.n(w),q=r(3),S=r.n(q),B=r(2),O=r.n(B);l.a.config();var P=new S.a.Schema({name:{type:String,required:!0,minlength:3,maxlength:50},email:{type:String,required:!0,minlength:5,maxlength:255,unique:!0},password:{type:String,required:!0,minlength:3,maxlength:255},isAdmin:Boolean});P.methods.generateAuthToken=function(){return d.a.sign({_id:this._id,isAdmin:this.isAdmin},process.env.SECRET_KEY)};var j=S.a.model("User",P),A=function(e){var t={name:O.a.string().min(3).max(50).required(),email:O.a.string().min(5).max(255).required().email(),password:O.a.string().min(3).max(255).required()};return O.a.validate(e,t)},_=j;function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var U={getCurrentUser:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.findById(t.user._id).select("-password");case 2:s=e.sent,r.send({success:!0,data:s});case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),getCurrentUserV2:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.headers.cookie||"",n=I.a.parse(s.replace(/\s/g,""),{delimiter:";"}),a={},u={},n.token){e.next=7;break}return r.status(200).send({message:"Not Login"}),e.abrupt("return");case 7:if((c=JSON.parse(n.token))&&(a.success=c.deadline>(new Date).getTime()),!a.success){e.next=14;break}return e.next=12,_.findById(c.id).select("-password");case 12:(i=e.sent)&&(u=D({permissions:{role:"admin"}},i));case 14:a.user=u,r.json(a);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),userRegister:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=A(t.body),!(n=s.error)){e.next=3;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 3:return e.next=5,_.findOne({email:t.body.email});case 5:if(!(a=e.sent)){e.next=8;break}return e.abrupt("return",r.status(400).send({success:!1,message:"User already registered."}));case 8:return a=new _({name:t.body.name,password:t.body.password,email:t.body.email}),e.next=11,k.a.hash(a.password,10);case 11:return a.password=e.sent,e.next=14,a.save();case 14:u=a.generateAuthToken(),r.header("x-auth-token",u).send({success:!0,data:{_id:a._id,name:a.name,email:a.email}});case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),userLogin:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOne({email:t.body.email});case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(404).send({success:!1,message:"User not found!"}));case 6:if(k.a.compareSync(t.body.password,s.password)){e.next=9;break}return e.abrupt("return",r.status(401).send({success:!1,message:"Password not valid!"}));case 9:n=s.generateAuthToken(),(a=new Date).setDate(a.getDate()+1),r.cookie("token",JSON.stringify({id:s._id,deadline:a.getTime()}),{maxAge:9e5,httpOnly:!0}),r.status(200).header("x-auth-token",n).send({success:!0,data:{_id:s._id,name:s.name,email:s.email}}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),userLogout:function(e,t){t.clearCookie("token"),t.status(200).header("x-auth-token","").send({success:!0,message:"Logout successful"})}},T=Object(a.Router)();T.get("/current",m,U.getCurrentUser),T.post("/register",U.userRegister),T.post("/login",U.userLogin),T.get("/logout",U.userLogout),T.get("/",U.getCurrentUserV2);var R=T,z=r(11),E=r.n(z),F=r(14),M=r.n(F),L=function(e){return/^data:([A-Za-z-+\/]+);base64,(.+)$/.test(e)},$=function(){var e=x()(y.a.mark((function e(t){var r,s,a,u,c,i,o,d;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p=void 0,l=void 0,p=t.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/),l={},r=3!==p.length?{success:!1,message:"Invalid input string"}:(l.type=p[1],l.data=Buffer.from(p[2],"base64"),l),s=n.a.join(__dirname,"public"),a=E.a.randomBytes(20),u=E.a.createHash("sha1").update(a).digest("hex"),c=/\/(.*?)$/,i=r.type.match(c),o="image-"+u+"."+i[1],d=s+"/images/"+o,e.prev=9,M.a.writeFile(d,r.data,(function(e){return{success:!1,message:e}})),e.abrupt("return",{success:!0,message:"/public/images/".concat(o)});case 14:return e.prev=14,e.t0=e.catch(9),console.log("writeFile err"),e.abrupt("return",{success:!1,message:e.t0.message});case 18:e.next=24;break;case 20:return e.prev=20,e.t1=e.catch(0),console.log(e.t1),e.abrupt("return",{success:!1,message:e.t1.message});case 24:case"end":return e.stop()}var p,l}),e,null,[[0,20],[9,14]])})));return function(t){return e.apply(this,arguments)}}();l.a.config();var N=new S.a.Schema({title:{type:String,required:!0,minlength:3,maxlength:50,unique:!0},description:{type:String,unique:!1,required:!1},image:{type:String,unique:!1,required:!0},created_at:{type:Date,default:Date.now}}),Y=S.a.model("Category",N),G=function(e){var t={title:O.a.string().min(3).max(50).required(),description:O.a.string().allow("").optional(),image:O.a.string().required()};return O.a.validate(e,t)},Z=Y,H=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=G(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return e.next=6,$(t.body.image);case 6:if(a=e.sent,console.log("imagepath",a),a.success){e.next=10;break}return e.abrupt("return",r.status(500).send({success:!1,message:a.message}));case 10:return e.next=12,Z.findOne({title:t.body.title});case 12:if(!(u=e.sent)){e.next=15;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Category already existed."}));case 15:return u=new Z({title:t.body.title,description:t.body.description,image:a.message}),e.next=18,u.save();case 18:r.status(200).send({success:!0,message:"Add new category successfull"}),e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,r){return e.apply(this,arguments)}}(),J=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,e.next=5,Z.find().sort("-created_at").limit(s).skip(n);case 5:a=e.sent,r.status(200).send({success:!0,data:a}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),K={createCategory:H,getCategoryById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Category is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),updateCategoryById:function(){var e=x()(y.a.mark((function e(t,r){var s,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,!L(t.body.image)){e.next=9;break}return e.next=5,$(t.body.image);case 5:if((n=e.sent).success){e.next=8;break}return e.abrupt("return",r.status(500).send({success:!1,message:n.message}));case 8:s.image=n.message;case 9:return e.next=11,Z.findByIdAndUpdate(t.params.id,{$set:s});case 11:if(e.sent){e.next=14;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Category is not existed."}));case 14:r.status(200).send({success:!0,message:"Update category successfull"}),e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteCategoryById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Category is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete category successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllCategory:J},V=Object(a.Router)();V.get("/",K.getAllCategory),V.post("/",m,K.createCategory),V.get("/:id",K.getCategoryById),V.patch("/:id",K.updateCategoryById),V.delete("/:id",K.deleteCategoryById);var W=V,Q=r(9),X=r.n(Q);l.a.config();var ee=new S.a.Schema({title:{type:String,required:!0,minlength:3,maxlength:50,unique:!0},description:{type:String,unique:!1,required:!1},image:{type:Array,required:!0,default:[]},created_at:{type:Date,default:Date.now}}),te=S.a.model("Construction",ee),re=function(e){var t={title:O.a.string().min(3).max(50).required(),description:O.a.string().allow("").optional(),image:O.a.array().required()};return O.a.validate(e,t)},se=te;function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=re(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return a=t.body.image,u=[],a.forEach(function(){var e=x()(y.a.mark((function e(t){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t.url);case 2:if(s=e.sent,console.log("imagepath",s),s.success){e.next=6;break}return e.abrupt("return",r.status(500).send({success:!1,message:s.message}));case 6:u.push({uid:t.uid,name:t.name,status:t.status,url:s.message});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,se.findOne({title:t.body.title});case 9:if(!(c=e.sent)){e.next=12;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Construction already existed."}));case 12:return c=new se({title:t.body.title,description:t.body.description,image:u}),e.next=15,c.save();case 15:r.status(200).send({success:!0,message:"Add new construction successfull"}),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,r){return e.apply(this,arguments)}}(),ce=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,e.next=5,se.find().sort("-created_at").limit(s).skip(n);case 5:a=e.sent,r.status(200).send({success:!0,data:a}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),ie={createConstruction:ue,getConstructionById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,se.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Construction is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),updateConstructionById:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c,i,o,d,p,l,m,g;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,s=t.body,n=s.image,a=X()(s,["image"]),u=[],c=!0,i=!1,o=void 0,e.prev=6,d=n[Symbol.iterator]();case 8:if(c=(p=d.next()).done){e.next=32;break}if(l=p.value,!L(l.url)){e.next=19;break}return e.next=13,$(l.url);case 13:if((m=e.sent).success){e.next=16;break}return e.abrupt("return",r.status(500).send({success:!1,message:m.message}));case 16:u.push({uid:l.uid,name:l.name,status:l.status,url:m.message}),e.next=29;break;case 19:if(!l.thumbUrl){e.next=28;break}return e.next=22,$(l.thumbUrl);case 22:if((g=e.sent).success){e.next=25;break}return e.abrupt("return",r.status(500).send({success:!1,message:g.message}));case 25:u.push({uid:l.uid,name:l.name,status:l.status,url:g.message}),e.next=29;break;case 28:u.push({uid:l.uid,name:l.name,status:l.status,url:l.url});case 29:c=!0,e.next=8;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(6),i=!0,o=e.t0;case 38:e.prev=38,e.prev=39,c||null==d.return||d.return();case 41:if(e.prev=41,!i){e.next=44;break}throw o;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.next=48,se.findByIdAndUpdate(t.params.id,{$set:ae({},a,{image:u})});case 48:if(e.sent){e.next=51;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Construction is not existed."}));case 51:r.status(200).send({success:!0,message:"Update construction successfull"}),e.next=57;break;case 54:return e.prev=54,e.t1=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t1.message}));case 57:case"end":return e.stop()}}),e,null,[[0,54],[6,34,38,46],[39,,41,45]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteConstructionById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,se.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Construction is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete construction successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllConstruction:ce},oe=Object(a.Router)();oe.get("/",ie.getAllConstruction),oe.post("/",m,ie.createConstruction),oe.get("/:id",ie.getConstructionById),oe.patch("/:id",ie.updateConstructionById),oe.delete("/:id",ie.deleteConstructionById);var de=oe,pe=r(15),le=r.n(pe);l.a.config();var me=new S.a.Schema({name:{type:String,required:!0,minlength:3,maxlength:50,unique:!0},description:{type:String},documentation:{type:String},origin:{type:String},model_number:{type:String},dilivery_time:{type:String},warranty_time:{type:String},isShow:{type:Boolean,default:!1},image:{type:Array,required:!0,default:[]},category:{type:S.a.Schema.Types.ObjectId,ref:"Category"},created_at:{type:Date,default:Date.now}}),ge=S.a.model("Product",me),fe=function(e){var t={name:O.a.string().min(3).max(50).required(),description:O.a.string().allow("").optional(),documentation:O.a.string().allow("").optional(),origin:O.a.string().allow("").optional(),isShow:O.a.boolean(),model_number:O.a.string().allow("").optional(),dilivery_time:O.a.string().allow("").optional(),warranty_time:O.a.string().allow("").optional(),image:O.a.array().required(),category:O.a.string().required()};return O.a.validate(e,t)},be=ge;function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var xe=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=fe(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return a=t.body.image,u=[],a.forEach(function(){var e=x()(y.a.mark((function e(t){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t.url);case 2:if((s=e.sent).success){e.next=5;break}return e.abrupt("return",r.status(500).send({success:!1,message:s.message}));case 5:u.push({uid:t.uid,name:t.name,status:t.status,url:s.message});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,be.findOne({name:t.body.name});case 9:if(!(c=e.sent)){e.next=12;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Product already existed."}));case 12:return c=new be({name:t.body.name,description:t.body.description,documentation:t.body.documentation,origin:t.body.origin,model_number:t.body.model_number,dilivery_time:t.body.dilivery_time,warranty_time:t.body.warranty_time,image:u,isShow:t.body.isShow||!1,category:S.a.Types.ObjectId(t.body.category)}),e.next=15,c.save();case 15:r.status(200).send({success:!0,message:"Add new product successfull"}),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,r){return e.apply(this,arguments)}}(),he=function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,be.findById(t.params.id).populate("category");case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Product is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),ke=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c,i,o,d,p,l,m;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,a={},t.query.isShow&&(u="true"===t.query.isShow,a.isShow=u),t.query.pageSize&&(c=parseInt(t.query.pageSize),s=c),t.query.page&&(i=parseInt(t.query.page),n=s*i-s),t.query.category&&(o=S.a.Types.ObjectId(t.query.category),a.category=o),e.next=10,Promise.all([be.countDocuments(a),be.find(a).sort("-created_at").limit(s).skip(n).populate("category")]);case 10:return d=e.sent,p=le()(d,2),l=p[0],m=p[1],e.abrupt("return",r.status(200).send({success:!0,data:m,total:l}));case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),we={createProduct:xe,getProductById:he,updateProductById:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u,c,i,o,d,p,l,m,g;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,s=t.body,n=s.image,a=X()(s,["image"]),u=[],c=!0,i=!1,o=void 0,e.prev=6,d=n[Symbol.iterator]();case 8:if(c=(p=d.next()).done){e.next=32;break}if(l=p.value,!L(l.url)){e.next=19;break}return e.next=13,$(l.url);case 13:if((m=e.sent).success){e.next=16;break}return e.abrupt("return",r.status(500).send({success:!1,message:m.message}));case 16:u.push({uid:l.uid,name:l.name,status:l.status,url:m.message}),e.next=29;break;case 19:if(!l.thumbUrl){e.next=28;break}return e.next=22,$(l.thumbUrl);case 22:if((g=e.sent).success){e.next=25;break}return e.abrupt("return",r.status(500).send({success:!1,message:g.message}));case 25:u.push({uid:l.uid,name:l.name,status:l.status,url:g.message}),e.next=29;break;case 28:u.push({uid:l.uid,name:l.name,status:l.status,url:l.url});case 29:c=!0,e.next=8;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(6),i=!0,o=e.t0;case 38:e.prev=38,e.prev=39,c||null==d.return||d.return();case 41:if(e.prev=41,!i){e.next=44;break}throw o;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.next=48,be.findByIdAndUpdate(t.params.id,{$set:ve({},a,{image:u})});case 48:if(e.sent){e.next=51;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Product is not existed."}));case 51:r.status(200).send({success:!0,message:"Update product successfull"}),e.next=57;break;case 54:return e.prev=54,e.t1=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t1.message}));case 57:case"end":return e.stop()}}),e,null,[[0,54],[6,34,38,46],[39,,41,45]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteProductById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,be.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Product is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete product successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllProduct:ke},Ie=Object(a.Router)();Ie.get("/",we.getAllProduct),Ie.post("/",m,we.createProduct),Ie.get("/:id",we.getProductById),Ie.patch("/:id",we.updateProductById),Ie.delete("/:id",we.deleteProductById);var qe=Ie;l.a.config();var Se=new S.a.Schema({img:{data:Buffer,contentType:String},name:{type:String},product:{type:S.a.Schema.Types.ObjectId,ref:"Product"},created_at:{type:Date,default:Date.now}}),Be=S.a.model("Image",Se),Oe={uploadImage:function(){var e=x()(y.a.mark((function e(t,r){var s,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.body.image,u=void 0,c=void 0,u=a.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/),(c={}).contentType=u[1],c.data=Buffer.from(u[2],"base64"),s=c,e.prev=1,n=new Be,t.body.product?(n.img.data=s.data,n.img.contentType=s.contentType,n.name=t.body.name,n.product=t.body.product):(n.img.data=s.data,n.img.contentType=s.contentType,n.name=t.body.name),e.next=6,n.save();case 6:r.status(200).send({success:!0,message:"Upload image successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}var a,u,c}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getImageById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Be.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Image is not existed."}));case 6:s.img.data=s.img.data.toString("base64"),r.status(200).send({success:!0,data:s}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}()},Pe=Object(a.Router)();Pe.post("/upload",m,Oe.uploadImage),Pe.get("/:id",Oe.getImageById);var je=Pe,Ae=[{id:"1",icon:"dashboard",name:"Dashboard",zh:{name:"仪表盘"},"pt-br":{name:"Dashboard"},route:"/dashboard"},{id:"2",breadcrumbParentId:"1",name:"Products",zh:{name:"用户管理"},"pt-br":{name:"Usuário"},icon:"shopping-cart",route:"/product"},{id:"6",breadcrumbParentId:"1",name:"Categories",zh:{name:"范畴"},"pt-br":{name:"Usuário"},icon:"appstore",route:"/category"},{id:"3",breadcrumbParentId:"1",name:"Info",zh:{name:"范畴"},"pt-br":{name:"Usuário"},icon:"user",route:"/info"},{id:"4",breadcrumbParentId:"1",name:"Banner",zh:{name:"范畴"},"pt-br":{name:"Usuário"},icon:"build",route:"/banner"},{id:"5",breadcrumbParentId:"1",name:"Service",zh:{name:"范畴"},"pt-br":{name:"Usuário"},icon:"cluster",route:"/service"},{id:"8",breadcrumbParentId:"1",name:"Construction",zh:{name:"范畴"},"pt-br":{name:"Usuário"},icon:"cluster",route:"/construction"}],_e=function(e,t){t.status(200).json(Ae)},Ce=Object(a.Router)();Ce.get("/",_e);var De=Ce;l.a.config();var Ue=new S.a.Schema({company:{type:String},address:{type:String},email:{type:String},phone:{type:String},facebook:{type:String},messenger:{type:String},zalo:{type:String},skype:{type:String},viber:{type:String},logo:{type:String},created_at:{type:Date,default:Date.now}}),Te=S.a.model("Info",Ue),Re=function(e){var t={company:O.a.string().required(),address:O.a.string().allow("").optional(),phone:O.a.string().allow("").optional(),email:O.a.string().allow("").optional(),facebook:O.a.string().allow("").optional(),zalo:O.a.string().allow("").optional(),messenger:O.a.string().allow("").optional(),viber:O.a.string().allow("").optional(),skype:O.a.string().allow("").optional(),logo:O.a.string().allow("").optional()};return O.a.validate(e,t)},ze=Te,Ee=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=Re(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return e.next=6,$(t.body.logo);case 6:if(a=e.sent,console.log("imagepath",a),a.success){e.next=10;break}return e.abrupt("return",r.status(500).send({success:!1,message:a.message}));case 10:return e.next=12,ze.findOne({company:t.body.company});case 12:if(!(u=e.sent)){e.next=15;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Info already existed."}));case 15:return u=new ze({company:t.body.company,address:t.body.address,email:t.body.email,phone:t.body.phone,facebook:t.body.facebook,messenger:t.body.messenger,zalo:t.body.zalo,skype:t.body.skype,viber:t.body.viber,logo:a.message}),e.next=18,u.save();case 18:r.status(200).send({success:!0,message:"Add new info successfull"}),e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,r){return e.apply(this,arguments)}}(),Fe=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,e.next=5,ze.find().sort("-created_at").limit(s).skip(n);case 5:a=e.sent,r.status(200).send({success:!0,data:a}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),Me={createInfo:Ee,getInfoById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ze.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Info is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),updateInfoById:function(){var e=x()(y.a.mark((function e(t,r){var s,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,!L(t.body.logo)){e.next=9;break}return e.next=5,$(t.body.logo);case 5:if((n=e.sent).success){e.next=8;break}return e.abrupt("return",r.status(500).send({success:!1,message:n.message}));case 8:s.logo=n.message;case 9:return e.next=11,ze.findByIdAndUpdate(t.params.id,{$set:s});case 11:if(e.sent){e.next=14;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Info is not existed."}));case 14:r.status(200).send({success:!0,message:"Update info successfull"}),e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteInfoById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ze.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Info is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete info successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllInfo:Fe},Le=Object(a.Router)();Le.get("/",Me.getAllInfo),Le.post("/",m,Me.createInfo),Le.get("/:id",Me.getInfoById),Le.patch("/:id",Me.updateInfoById),Le.delete("/:id",Me.deleteInfoById);var $e=Le;l.a.config();var Ne=new S.a.Schema({title:{type:String,unique:!1,required:!1},description:{type:String,unique:!1,required:!1},created_at:{type:Date,default:Date.now},image:{type:String,unique:!1,required:!0}}),Ye=S.a.model("Banner",Ne),Ge=function(e){var t={title:O.a.string().allow("").optional(),description:O.a.string().allow("").optional(),image:O.a.string().required()};return O.a.validate(e,t)},Ze=Ye,He=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=Ge(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return e.next=6,$(t.body.image);case 6:if(a=e.sent,console.log("imagepath",a),a.success){e.next=10;break}return e.abrupt("return",r.status(500).send({success:!1,message:a.message}));case 10:return u=new Ze({title:t.body.title,description:t.body.description,image:a.message}),e.next=13,u.save();case 13:r.status(200).send({success:!0,message:"Add new banner successfull"}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Je=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,e.next=5,Ze.find().sort("-created_at").limit(s).skip(n);case 5:a=e.sent,r.status(200).send({success:!0,data:a}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),Ke={createBanner:He,getBannerById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ze.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Banner is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),updateBannerById:function(){var e=x()(y.a.mark((function e(t,r){var s,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,!L(t.body.image)){e.next=9;break}return e.next=5,$(t.body.image);case 5:if((n=e.sent).success){e.next=8;break}return e.abrupt("return",r.status(500).send({success:!1,message:n.message}));case 8:s.image=n.message;case 9:return e.next=11,Ze.findByIdAndUpdate(t.params.id,{$set:s});case 11:if(e.sent){e.next=14;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Banner is not existed."}));case 14:r.status(200).send({success:!0,message:"Update banner successfull"}),e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteBannerById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ze.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Banner is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete banner successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllBanner:Je},Ve=Object(a.Router)();Ve.get("/",Ke.getAllBanner),Ve.post("/",m,Ke.createBanner),Ve.get("/:id",Ke.getBannerById),Ve.patch("/:id",Ke.updateBannerById),Ve.delete("/:id",Ke.deleteBannerById);var We=Ve;l.a.config();var Qe=new S.a.Schema({title:{type:String,required:!0,minlength:3,maxlength:50,unique:!0},description:{type:String,unique:!1,required:!1},image:{type:String,unique:!1,required:!0},created_at:{type:Date,default:Date.now}}),Xe=S.a.model("Service",Qe),et=function(e){var t={title:O.a.string().min(3).max(50).required(),description:O.a.string().allow("").optional(),image:O.a.string().required()};return O.a.validate(e,t)},tt=Xe,rt=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=et(t.body),!(n=s.error)){e.next=4;break}return e.abrupt("return",r.status(400).send({success:!1,message:n.details[0].message}));case 4:return e.next=6,$(t.body.image);case 6:if(a=e.sent,console.log("imagepath",a),a.success){e.next=10;break}return e.abrupt("return",r.status(500).send({success:!1,message:a.message}));case 10:return e.next=12,tt.findOne({title:t.body.title});case 12:if(!(u=e.sent)){e.next=15;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Service already existed."}));case 15:return u=new tt({title:t.body.title,description:t.body.description,image:a.message}),e.next=18,u.save();case 18:r.status(200).send({success:!0,message:"Add new service successfull"}),e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,r){return e.apply(this,arguments)}}(),st=function(){var e=x()(y.a.mark((function e(t,r){var s,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=parseInt(t.query.limit)||10,n=parseInt(t.query.skip)||0,e.next=5,tt.find().sort("-created_at").limit(s).skip(n);case 5:a=e.sent,r.status(200).send({success:!0,data:a}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),nt={createService:rt,getServiceById:function(){var e=x()(y.a.mark((function e(t,r){var s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,tt.findById(t.params.id);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Service is not existed."}));case 6:r.status(200).send({success:!0,data:s}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),updateServiceById:function(){var e=x()(y.a.mark((function e(t,r){var s,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,!L(t.body.image)){e.next=9;break}return e.next=5,$(t.body.image);case 5:if((n=e.sent).success){e.next=8;break}return e.abrupt("return",r.status(500).send({success:!1,message:n.message}));case 8:s.image=n.message;case 9:return e.next=11,tt.findByIdAndUpdate(t.params.id,{$set:s});case 11:if(e.sent){e.next=14;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Service is not existed."}));case 14:r.status(200).send({success:!0,message:"Update service successfull"}),e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),deleteServiceById:function(){var e=x()(y.a.mark((function e(t,r){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,tt.findByIdAndRemove(t.params.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send({success:!1,message:"Service is not existed."}));case 6:r.status(200).send({success:!0,message:"Delete service successfull"}),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),getAllService:st},at=Object(a.Router)();at.get("/",nt.getAllService),at.post("/",m,nt.createService),at.get("/:id",nt.getServiceById),at.patch("/:id",nt.updateServiceById),at.delete("/:id",nt.deleteServiceById);var ut=at,ct=r(16),it=r.n(ct),ot={sendMail:function(){var e=x()(y.a.mark((function e(t,r){var s,n,a,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ze.find();case 3:return s=e.sent,n=s[0].email,a=it.a.createTransport({host:"smtp.gmail.com",port:587,secure:!1,auth:{user:"lequochungcdt@gmail.com",pass:"qamrbrinoazkahec"}}),e.next=8,a.sendMail({from:"lequochungcdt@gmail.com",to:n,subject:"From vulocgroup  - Yêu cầu từ ".concat(t.body.name),text:"Yêu cầu từ ".concat(t.body.name," - số điện thoại ").concat(t.body.phone," với nội dung: ").concat(t.body.message),html:"<div>Yêu cầu từ:<div> <h4>".concat(t.body.name,"</h4> - <div>số điện thoại:</div> <h3>").concat(t.body.phone,"</h3> <div>Email:</div> <h3>").concat(t.body.email,"</h3> <div>Nội dung:</div> <p>").concat(t.body.message,"</p>")});case 8:return u=e.sent,e.abrupt("return",r.status(200).send({success:!0,message:u.messageId}));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).send({success:!1,message:e.t0.message}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}()},dt=Object(a.Router)();dt.post("/",ot.sendMail);var pt={user:R,category:W,construction:de,product:qe,image:je,sidebarList:De,info:$e,banner:We,service:ut,mail:dt};l.a.config();var lt=function(){var e=x()(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.a.connect(process.env.MONGOLAB_URI,{useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1,useUnifiedTopology:!0});case 3:console.log("MongoDB Connected..."),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0.message),process.exit(1);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),mt=u()(),gt=__dirname,ft=n.a.join(gt,"admin/index.html"),bt=n.a.join(gt,"index.html");mt.use(u.a.static(gt)),mt.use(i()()),mt.use(r(18).set("prerenderToken","i8cyfM0flaG7Ls7lNrHR")),mt.use(u.a.json({limit:"50mb"})),mt.use(u.a.urlencoded({limit:"50mb"})),mt.get("/admin/*",(function(e,t){t.sendFile(ft)})),mt.use("/api/user",pt.user),mt.use("/api/categories",pt.category),mt.use("/api/constructions",pt.construction),mt.use("/api/products",pt.product),mt.use("/api/photos",pt.image),mt.use("/api/routes",pt.sidebarList),mt.use("/api/info",pt.info),mt.use("/api/banners",pt.banner),mt.use("/api/services",pt.service),mt.use("/api/sendmail",pt.mail),mt.get("/",(function(e,t){t.sendFile(bt)})),mt.get("/contact",(function(e,t){t.sendFile(bt)})),mt.get("/products",(function(e,t){t.sendFile(bt)})),mt.get("/product/*",(function(e,t){t.sendFile(bt)})),mt.get("/services",(function(e,t){t.sendFile(bt)})),mt.get("/constructions",(function(e,t){t.sendFile(bt)}));var yt=process.env.PORT||8080;lt(),mt.listen(yt,(function(){console.log("App listening to ".concat(yt,"....")),console.log("Press Ctrl+C to quit.")}))}]);